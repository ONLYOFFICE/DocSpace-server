<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <title>Example</title>
</head>
<body>
    <h1>Auth token</h1>
    <button id="getAuthTokenButton">Get Auth Token</button>
    <br />
    <br />
    <div id="getAuthTokenResult"></div>


    <h1>Generate Keys</h1>
    <input type="text" id="generateKeysEmail" placeholder="Email" />
    <button id="generateKeysButton">Generate Keys</button>
    <br />
    <br />
    <div id="generateKeysResult"></div>


    <h1>Validate Keys</h1>
    <input type="text" id="validateKeysEmailKey" placeholder="EmailKey" />
    <input type="text" id="validateKeysLinkKey" placeholder="LinkKey" />
    <input type="text" id="validateKeysPage" placeholder="Page" />
    <button id="validateKeysButton">Validate Keys</button>
    <br />
    <br />
    <div id="validateKeysResult"></div>


    <h1>Sign In</h1>
    <button id="signInByGoogleButton">Sign In By Google</button>
    <br />
    <br />
    <input type="text" id="signInEmail" placeholder="Email" />
    <input type="password" id="signInPassword" placeholder="Password" />
    <button id="signInButton">Sign In</button>
    <button id="passwordButton">Reset Password</button>
    <br />
    <br />
    <div id="signInResult"></div>

    <h1>Sign Up</h1>
    <button id="signUpByGoogleButton">Sign Up By Google</button>
    <br />
    <br />
    <input type="text" id="signUpEmail" placeholder="Email" />
    <button id="signUpButton">Sign Up</button>
    <br />
    <br />
    <div id="signUpResult"></div>

    <h1>Find Portal</h1>
    <input type="text" id="findPortalDomain" placeholder="Domain" />
    <button id="findPortalButton">Find Portal</button>
    <br />
    <br />
    <div id="findPortalResult"></div>

    <h1>Send Email</h1>
    <input type="text" id="email" placeholder="Email" />
    <button id="sendEmailButton">Send Email</button>
    <br />
    <br />
    <div id="sendEmailResult"></div>
    <br />
    <br />

    <script type="text/javascript">

        var modalDialog = null;
        var interval = null;
        var authToken = null;


        document.getElementById('signInByGoogleButton').onclick = function () {
            modalDialog = window.open(location.href + "/login?auth=google&mode=popup&callback=SignInByGoogle", "signup", "width=800,height=500,status=no,toolbar=no,menubar=no,resizable=yes,scrollbars=no");
            interval = setInterval(checkSignInCode, 500);
            return false;
        };

        function checkSignInCode(data) {
            const code = localStorage.getItem("code");
            if (code) {
                localStorage.removeItem("code");
                clearInterval(interval);

                providerName = "google";

                const token = window.btoa(
                    JSON.stringify({
                        auth: providerName,
                        mode: "popup",
                        callback: "SignInByGoogle",
                    }),
                );

                modalDialog.location.href = location.href + `/login?p=${token}&code=${code}`;
            }
        }

        function SignInByGoogle(data) {
            try {
                console.log(JSON.stringify(data));

                fetch("/multiregion/findbysocial", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: authToken
                    },
                    body: JSON.stringify({ transport: data })
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log(JSON.stringify(data));
                        document.getElementById('signInResult').innerText = JSON.stringify(data);
                    })
                    .catch(error => {
                        console.error("Error:", error);
                    });

            } catch (error) {
                console.log(JSON.stringify(error.response ? error.response.data : error.message));
            }
        }


        document.getElementById('signInButton').onclick = function () {
            const email = document.getElementById('signInEmail').value;
            const password = document.getElementById('signInPassword').value;
            const passwordHash = null;
            const body = { email, password, passwordHash };

            fetch("/multiregion/findbyemailpassword", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: authToken
                },
                body: JSON.stringify(body)
            })
                .then(response => response.json())
                .then(data => {
                    console.log(JSON.stringify(data));
                    document.getElementById('signInResult').innerText = JSON.stringify(data);
                })
                .catch(error => {
                    console.error("Error:", error);
                });

            return false;
        };

        document.getElementById('passwordButton').onclick = function () {
            const email = document.getElementById('signInEmail').value;

            fetch("/multiregion/resetpassword", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: authToken
                },
                body: JSON.stringify({ email })
            })
                .then(response => response.json())
                .then(data => {
                    console.log(JSON.stringify(data));
                    document.getElementById('signInResult').innerText = JSON.stringify(data);
                })
                .catch(error => {
                    console.error("Error:", error);
                });

            return false;
        };


        document.getElementById('signUpByGoogleButton').onclick = function () {
            modalDialog = window.open(location.href + "/login?auth=google&mode=popup&callback=SignUpByGoogle", "signup", "width=800,height=500,status=no,toolbar=no,menubar=no,resizable=yes,scrollbars=no");
            interval = setInterval(checkSignUpCode, 500);
            return false;
        };

        function checkSignUpCode(data) {
            const code = localStorage.getItem("code");
            if (code) {
                localStorage.removeItem("code");
                clearInterval(interval);

                providerName = "google";

                const token = window.btoa(
                    JSON.stringify({
                        auth: providerName,
                        mode: "popup",
                        callback: "SignUpByGoogle",
                    }),
                );

                modalDialog.location.href = location.href + `/login?p=${token}&code=${code}`;
            }
        }

        function SignUpByGoogle(data) {
            try {
                console.log(JSON.stringify(data));

                fetch("/thirdparty/register", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: authToken
                    },
                    body: JSON.stringify({ thirdPartyProfile: data })
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log(JSON.stringify(data));
                        document.getElementById('signUpResult').innerText = JSON.stringify(data);
                    })
                    .catch(error => {
                        console.error("Error:", error);
                    });

            } catch (error) {
                console.log(JSON.stringify(error.response ? error.response.data : error.message));
            }
        }


        document.getElementById('signUpButton').onclick = function () {
            const email = document.getElementById('signUpEmail').value;

            fetch("/thirdparty/register", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: authToken
                },
                body: JSON.stringify({ email })
            })
                .then(response => response.json())
                .then(data => {
                    console.log(JSON.stringify(data));
                    document.getElementById('signUpResult').innerText = JSON.stringify(data);
                })
                .catch(error => {
                    console.error("Error:", error);
                });

            return false;
        };


        document.getElementById('findPortalButton').onclick = function () {
            const domain = document.getElementById('findPortalDomain').value;

            fetch("/multiregion/findbydomain", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: authToken
                },
                body: JSON.stringify({ domain })
            })
                .then(response => response.text())
                .then(data => {
                    console.log(data);
                    document.getElementById('findPortalResult').innerText = data || "not found";
                })
                .catch(error => {
                    console.error("Error:", error);
                });

            return false;
        };


        document.getElementById('sendEmailButton').onclick = function () {
            const email = document.getElementById('email').value;

            const body = {
                "Email": email,
                "Subject": "subject",
                "Body": "body"
            };

            fetch("/email/send", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: authToken
                },
                body: JSON.stringify(body)
            })
                .then(response => response.json())
                .then(data => {
                    console.log(JSON.stringify(data));
                    document.getElementById('sendEmailResult').innerText = JSON.stringify(data);
                })
                .catch(error => {
                    console.error("Error:", error);
                });

            return false;
        };

        document.getElementById('generateKeysButton').onclick = function () {
            const email = document.getElementById('generateKeysEmail').value;

            fetch("/key/generate", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: authToken
                },
                body: JSON.stringify({ email })
            })
                .then(response => response.json())
                .then(data => {
                    console.log(JSON.stringify(data));
                    document.getElementById('generateKeysResult').innerText = JSON.stringify(data);
                })
                .catch(error => {
                    console.error("Error:", error);
                });

            return false;
        };

        document.getElementById('validateKeysButton').onclick = function () {
            const emailKey = document.getElementById('validateKeysEmailKey').value;
            const linkKey = document.getElementById('validateKeysLinkKey').value;
            const page = document.getElementById('validateKeysPage').value;

            fetch("/key/validate", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: authToken
                },
                body: JSON.stringify({ emailKey, linkKey, page })
            })
                .then(response => response.json())
                .then(data => {
                    console.log(JSON.stringify(data));
                    document.getElementById('validateKeysResult').innerText = JSON.stringify(data);
                })
                .catch(error => {
                    console.error("Error:", error);
                });

            return false;
        };

        document.getElementById('getAuthTokenButton').onclick = function () {
            fetch("/thirdparty/authtoken", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            })
                .then(response => response.text())
                .then(data => {
                    console.log(data);
                    document.getElementById('getAuthTokenResult').innerText = data;
                    authToken = data;
                })
                .catch(error => {
                    console.error("Error:", error);
                });

            return false;
        };
    </script>
</body>
</html>